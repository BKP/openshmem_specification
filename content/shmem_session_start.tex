\apisummary{
    Start a communication session.
}

\begin{apidefinition}

\begin{Csynopsis}
void @\FuncDecl{shmem\_session\_start}@(shmem_ctx_t ctx, long options);
\end{Csynopsis}

\begin{apiarguments}
    \apiargument{IN}{ctx}{A context handle specifying the context associated
    with this session.}
    \apiargument{IN}{options}{The set of requested options from
    Table~\ref{session_opts} for this session.  Multiple options may be
    requested by combining them with a bitwise OR operation; otherwise,
    \CONST{0} can be given if no options are requested.}
\end{apiarguments}

\apidescription{
    \FUNC{shmem\_session\_start} is a non-collective routine that begins a
    session on communication context \VAR{ctx} with hints requested via
    \VAR{options}.
    Sessions on a communication context must be stopped with a call to
    \FUNC{shmem\_session\_stop} on the same context.
    If a session is already started on a given context, another call to
    \FUNC{shmem\_session\_start} on that same context combines new options via a
    bitwise OR operation.
    If \VAR{ctx} compares equal to \LibConstRef{SHMEM\_CTX\_INVALID} then
    \FUNC{shmem\_session\_start} performs no action and returns immediately.

    No combination of \VAR{options} passed to \FUNC{shmem\_session\_start}
    results in undefined behavior, but some combinations may be detrimental for
    performance; for example, when selecting an option that is not applicable
    to the session. It is the user's responsibility to determine which
    combination of \VAR{options} benefits the performance of the session.
}

\apireturnvalues{
    None.
}

\sessiontablebegin

\sessiontablerow{\LibConstRef{SHMEM\_SESSION\_BATCH}}{
    A \textit{batch} is a series of calls to OpenSHMEM routines, which occur
    within a session in program order, that might tolerate an increase in
    individual call latencies at the opportunity to decrease the overall
    overhead typically involved with the OpenSHMEM library implementing the
    series as individual RMA operations.
    In other words, the performance of \openshmem programs that issue many
    consecutive and small-sized RMA routines (called a \textit{batch}) might be
    improved by informing the library implementation ahead of time that it is
    free to delay initiating the operations in order to combine or coalesce the
    issued \openshmem routines.
    The specific mechanisms for improving performance using batching
    optimizations depend on the \openshmem library implementation.

    The \VAR{SHMEM\_SESSION\_BATCH} hint indicates that a communication context
    will be used to issue a batch.  An example of a
    batch is an iterative loop of non-blocking RMA and/or AMO routines. A batch
    must not include a memory ordering or collective operation.

    Because sessions do not affect the completion or ordering semantics of any
    \openshmem routines in the program, routines such as non-blocking RMAs,
    non-blocking AMOs, non-blocking \OPR{put-with-signals}, blocking scalar
    \OPR{puts}, small blocking \OPR{puts}, and blocking non-fetching AMOs are
    viable candidates for batching.  Other routines, such as large blocking
    \OPR{puts}, all blocking \OPR{gets}, blocking fetching AMOs, and the memory
    ordering routines might require the library to enforce completions,
    reducing the potential benefit of batching.
    } \hline

\sessiontablerow{\LibConstRef{SHMEM\_SESSION\_SAME\_AMO}}{
    The session will contain a batch (as defined by the
    \VAR{SHMEM\_SESSION\_BATCH} option) of only AMOs that will not occur
    concurrently across any different signal operators
    (i.e.~\ref{subsec:signal_operator}), operations (\ref{sec:amo}), or types
    (Tables \ref{stdamotypes} and \ref{extamotypes}).
    } \hline

\sessiontableend

\apinotes{
    The \FUNC{shmem\_session\_start} routine provides hints for improving
    performance, and \openshmem implementations are not required to apply any
    optimization.
    \FUNC{shmem\_session\_start} is non-collective, so there is no implied
    synchronization.
    Blocking puts must be sufficiently small to benefit from batching, and the
    exact threshold for this benefit depends on the \openshmem implemenation
    and/or the application.
}

\end{apidefinition}
